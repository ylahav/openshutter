{"version":3,"file":"_server.ts-DxSvFI8u.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/auth/login/_server.ts.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport { SignJWT } from \"jose\";\nimport { b as private_env } from \"../../../../chunks/shared-server.js\";\nconst JWT_SECRET = new TextEncoder().encode(\n  private_env.AUTH_JWT_SECRET || private_env.NEXTAUTH_SECRET || process.env.AUTH_JWT_SECRET || process.env.NEXTAUTH_SECRET || \"dev-secret-change-me-in-production\"\n);\nconst JWT_TTL = 60 * 60 * 24 * 7;\nconst BACKEND_URL = private_env.BACKEND_URL || process.env.BACKEND_URL || \"http://localhost:5000\";\nconst POST = async ({ request, cookies }) => {\n  try {\n    const { email, password } = await request.json();\n    if (!email || !password) {\n      return json({ error: \"Missing credentials\" }, { status: 400 });\n    }\n    const response = await fetch(`${BACKEND_URL}/api/auth/login`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({ email, password })\n    });\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({ error: \"Login failed\" }));\n      return json({ error: errorData.error || \"Invalid credentials\" }, { status: response.status });\n    }\n    const data = await response.json();\n    const { user } = data;\n    const jwt = await new SignJWT({\n      email: user.email,\n      name: user.name,\n      role: user.role\n    }).setProtectedHeader({ alg: \"HS256\" }).setSubject(user.id).setIssuedAt().setExpirationTime(`${JWT_TTL}s`).sign(JWT_SECRET);\n    cookies.set(\"auth_token\", jwt, {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === \"production\",\n      path: \"/\",\n      maxAge: JWT_TTL,\n      sameSite: \"lax\"\n    });\n    return json({ role: user.role, user });\n  } catch (error) {\n    console.error(\"Login error:\", error);\n    return json({ error: \"Login failed\" }, { status: 500 });\n  }\n};\nexport {\n  POST\n};\n"],"names":[],"mappings":"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"}