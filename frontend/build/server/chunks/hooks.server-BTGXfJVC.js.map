{"version":3,"file":"hooks.server-BTGXfJVC.js","sources":["../../../.svelte-kit/adapter-node/chunks/hooks.server.js"],"sourcesContent":["import { jwtVerify } from \"jose\";\nimport { b as private_env } from \"./shared-server.js\";\nconst JWT_SECRET = new TextEncoder().encode(\n  private_env.AUTH_JWT_SECRET || private_env.NEXTAUTH_SECRET || process.env.AUTH_JWT_SECRET || process.env.NEXTAUTH_SECRET || \"dev-secret-change-me-in-production\"\n);\nconst handle = async ({ event, resolve }) => {\n  event.locals.user = null;\n  const token = event.cookies.get(\"auth_token\");\n  if (token) {\n    try {\n      const { payload } = await jwtVerify(token, JWT_SECRET);\n      event.locals.user = {\n        id: String(payload.sub),\n        email: String(payload.email),\n        name: String(payload.name),\n        role: payload.role ?? \"owner\"\n      };\n    } catch {\n      event.cookies.delete(\"auth_token\", { path: \"/\" });\n    }\n  }\n  const path = event.url.pathname;\n  if (path.startsWith(\"/admin\")) {\n    if (!event.locals.user || event.locals.user.role !== \"admin\") {\n      return Response.redirect(new URL(\"/login?redirect=\" + encodeURIComponent(path), event.url), 303);\n    }\n  }\n  if (path.startsWith(\"/owner\")) {\n    if (!event.locals.user || event.locals.user.role !== \"owner\" && event.locals.user.role !== \"admin\") {\n      return Response.redirect(new URL(\"/login?redirect=\" + encodeURIComponent(path), event.url), 303);\n    }\n  }\n  return resolve(event);\n};\nexport {\n  handle\n};\n"],"names":[],"mappings":";;;AAEA,MAAM,UAAU,GAAG,IAAI,WAAW,EAAE,CAAC,MAAM;AAC3C,EAAE,WAAW,CAAC,eAAe,IAAI,WAAW,CAAC,eAAe,IAAI,OAAO,CAAC,GAAG,CAAC,eAAe,IAAI,OAAO,CAAC,GAAG,CAAC,eAAe,IAAI;AAC9H,CAAC;AACI,MAAC,MAAM,GAAG,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK;AAC7C,EAAE,KAAK,CAAC,MAAM,CAAC,IAAI,GAAG,IAAI;AAC1B,EAAE,MAAM,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,YAAY,CAAC;AAC/C,EAAE,IAAI,KAAK,EAAE;AACb,IAAI,IAAI;AACR,MAAM,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,SAAS,CAAC,KAAK,EAAE,UAAU,CAAC;AAC5D,MAAM,KAAK,CAAC,MAAM,CAAC,IAAI,GAAG;AAC1B,QAAQ,EAAE,EAAE,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC;AAC/B,QAAQ,KAAK,EAAE,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC;AACpC,QAAQ,IAAI,EAAE,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC;AAClC,QAAQ,IAAI,EAAE,OAAO,CAAC,IAAI,IAAI;AAC9B,OAAO;AACP,IAAI,CAAC,CAAC,MAAM;AACZ,MAAM,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,YAAY,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC;AACvD,IAAI;AACJ,EAAE;AACF,EAAE,MAAM,IAAI,GAAG,KAAK,CAAC,GAAG,CAAC,QAAQ;AACjC,EAAE,IAAI,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE;AACjC,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE;AAClE,MAAM,OAAO,QAAQ,CAAC,QAAQ,CAAC,IAAI,GAAG,CAAC,kBAAkB,GAAG,kBAAkB,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,GAAG,CAAC,EAAE,GAAG,CAAC;AACtG,IAAI;AACJ,EAAE;AACF,EAAE,IAAI,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE;AACjC,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,OAAO,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE;AACxG,MAAM,OAAO,QAAQ,CAAC,QAAQ,CAAC,IAAI,GAAG,CAAC,kBAAkB,GAAG,kBAAkB,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,GAAG,CAAC,EAAE,GAAG,CAAC;AACtG,IAAI;AACJ,EAAE;AACF,EAAE,OAAO,OAAO,CAAC,KAAK,CAAC;AACvB;;;;"}